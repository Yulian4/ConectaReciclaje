<div class="container-fluid vh-100 d-flex flex-column">
  <!-- Header -->
  <header class="d-flex align-items-center justify-content-between p-4 pb-2">
    <button class="btn btn-transparent text-dark p-0" (click)="navigateBack()">
      <span class="material-symbols-outlined fs-4">arrow_back</span>
    </button>
    <h1 class="fw-bold fs-5 mb-0 flex-grow-1 text-center">Seguimiento - {{reporte.id}}</h1>
    <div style="width: 48px;"></div>
  </header>

  <!-- Status Banner -->
  <div class="px-4 py-3" [ngClass]="{
    'bg-warning bg-opacity-10': reporte.estado === 'pendiente',
    'bg-info bg-opacity-10': reporte.estado === 'asignado',
    'bg-primary bg-opacity-10': reporte.estado === 'en_camino',
    'bg-success bg-opacity-10': reporte.estado === 'recolectado'
  }">
    <p class="text-center fw-bold mb-0" [ngClass]="{
      'text-warning': reporte.estado === 'pendiente',
      'text-info': reporte.estado === 'asignado',
      'text-primary': reporte.estado === 'en_camino',
      'text-success': reporte.estado === 'recolectado'
    }">{{getStatusText()}}</p>
  </div>

  <!-- Progress Bar -->
  <div class="px-4 py-3">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <small class="text-muted">Progreso</small>
      <small class="text-muted">{{getProgressPercentage()}}%</small>
    </div>
    <div class="progress" style="height: 8px;">
      <div class="progress-bar bg-primary"
           role="progressbar"
           [style.width.%]="getProgressPercentage()"
           [attr.aria-valuenow]="getProgressPercentage()"
           aria-valuemin="0"
           aria-valuemax="100">
      </div>
    </div>
  </div>

  <!-- UrbanIA Message -->
  <div class="px-4 py-3">
    <div class="bg-light rounded-3 p-3 d-flex align-items-start gap-3">
      <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; min-width: 40px;">
        <span class="material-symbols-outlined text-white fs-5">smart_toy</span>
      </div>
      <div class="flex-grow-1">
        <div class="d-flex align-items-center gap-2 mb-1">
          <strong class="text-primary">UrbanIA</strong>
          <small class="text-muted">Asistente IA</small>
        </div>
        <p class="mb-0 text-dark">{{getUrbanIAMessage()}}</p>
      </div>
    </div>
  </div>

  <!-- Timeline -->
  <div class="p-6">
    <div class="d-flex flex-column">
      <!-- Etapa 1: Enviado -->
      <div class="d-flex mb-4">
        <div class="d-flex flex-column align-items-center me-4">
          <div class="d-flex align-items-center justify-content-center rounded-circle bg-primary text-white mb-2" style="width: 40px; height: 40px;">
            <span class="material-symbols-outlined fs-5">mail</span>
          </div>
          <div class="bg-primary" style="width: 2px; height: 64px;"></div>
        </div>
        <div class="flex-grow-1">
          <p class="fw-bold mb-1 text-dark">Reporte Enviado</p>
          <p class="text-muted small mb-0">Junio 1, 10:00 AM</p>
        </div>
      </div>

      <!-- Etapa 2: Asignado -->
      <div class="d-flex mb-4">
        <div class="d-flex flex-column align-items-center me-4">
          <div class="d-flex align-items-center justify-content-center rounded-circle bg-primary text-white mb-2" style="width: 40px; height: 40px;">
            <span class="material-symbols-outlined fs-5">person</span>
          </div>
          <div class="bg-primary" style="width: 2px; height: 64px;"></div>
        </div>
        <div class="flex-grow-1">
          <p class="fw-bold mb-1 text-dark">Reciclador Asignado</p>
          <p class="text-muted small mb-1">Juan Pérez</p>
          <p class="text-muted small mb-0">Junio 1, 11:30 AM</p>
        </div>
      </div>

      <!-- Etapa 3: Recolectado -->
      <div class="d-flex mb-4">
        <div class="d-flex flex-column align-items-center me-4">
          <div class="d-flex align-items-center justify-content-center rounded-circle bg-primary text-white mb-2" style="width: 40px; height: 40px;">
            <span class="material-symbols-outlined fs-5">local_shipping</span>
          </div>
          <div class="bg-primary" style="width: 2px; height: 64px;"></div>
        </div>
        <div class="flex-grow-1">
          <p class="fw-bold mb-1 text-dark">Material Recolectado</p>
          <p class="text-muted small mb-0">Junio 2, 9:00 AM</p>
        </div>
      </div>

      <!-- Etapa 4: Confirmado -->
      <div class="d-flex">
        <div class="d-flex flex-column align-items-center me-4">
          <div class="d-flex align-items-center justify-content-center rounded-circle bg-primary text-white mb-2" style="width: 40px; height: 40px;">
            <span class="material-symbols-outlined fs-5">check_circle</span>
          </div>
        </div>
        <div class="flex-grow-1">
          <p class="fw-bold mb-1 text-dark">Recolección Confirmada</p>
          <p class="text-muted small mb-0">Junio 2, 9:15 AM</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Impact Card -->
  <div class="px-4 py-3" *ngIf="reporte.estado === 'recolectado'">
    <div class="card border-0 shadow-sm bg-white rounded-3">
      <div class="card-body d-flex flex-column align-items-center text-center p-4">
        <span class="material-symbols-outlined fs-1 text-success mb-3">eco</span>
        <p class="fs-5 fw-bold mb-2 text-dark">¡Gracias por reciclar!</p>
        <p class="text-muted mb-2">Tu {{reporte.tipoMaterial.toLowerCase()}} fue recolectado por <strong>{{reporte.reciclador}}</strong>.</p>
        <div class="row g-3 w-100 mt-2">
          <div class="col-6">
            <div class="text-center">
              <div class="text-primary fw-bold fs-4">{{reporte.pesoEstimado}}kg</div>
              <div class="text-muted small">Material recolectado</div>
            </div>
          </div>
          <div class="col-6">
            <div class="text-center">
              <div class="text-success fw-bold fs-4">{{reporte.co2Evitado}}kg</div>
              <div class="text-muted small">CO₂ evitado</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="px-4 py-3 mt-auto">
    <div class="d-flex flex-column gap-2">
      <button class="btn btn-primary rounded-pill py-3 fw-bold" (click)="navigateToNuevoReporte()">
        Reportar otro material
      </button>
      <button class="btn btn-outline-secondary rounded-pill py-3 fw-bold" (click)="cerrar()">
        Volver al inicio
      </button>
    </div>
  </div>
</div>
